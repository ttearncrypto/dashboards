
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<!-- Settings Modal -->
<div id="ts-settings-modal" class="ts-settings-modal-overlay" style="display: none;">
    <div class="ts-settings-modal-panel">
        <button id="ts-settings-close-btn" class="ts-settings-close-btn">×</button>
        <h2>Settings & Guide</h2>
        
        <div class="ts-settings-section">
            <h3>Appearance</h3>
            <div class="ts-setting-item">
                <label for="ts-font-family-select">Font Family</label>
                <select id="ts-font-family-select">
                    <option value='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif'>System Default</option>
                    <option value='Inter, sans-serif'>Inter</option>
                    <option value='Verdana, sans-serif'>Verdana</option>
                    <option value='Georgia, serif'>Georgia</option>
                </select>
            </div>
            <div class="ts-setting-item">
                <label for="ts-font-size-select">Font Size</label>
                <select id="ts-font-size-select">
                    <option value="14px">Small</option>
                    <option value="16px">Normal</option>
                    <option value="18px">Large</option>
                </select>
            </div>
        </div>

        <div class="ts-settings-section">
            <h3><i class="fas fa-keyboard"></i> Keyboard Shortcuts Guide:</h3>
            <ul class="ts-shortcut-list">
                <li><span>/</span> Focus the search bar</li>
                <li><span>Esc</span> Clear search focus</li>
                <li><span>j</span> or <span>↓</span> Navigate down the list</li>
                <li><span>k</span> or <span>↑</span> Navigate up the list</li>
                <li><span>Enter</span> Open selected project</li>
                <li><span>n</span> Go to the next page</li>
                <li><span>p</span> Go to the previous page</li>
            </ul>
        </div>
    </div>
</div>


<div class="ts-table-dashboard-container" id="ts-main-container">
    <aside class="ts-sidebar">
        <div class="ts-sidebar-logo">
            <i class="fab fa-bitcoin"></i>
        </div>
        <nav id="ts-sidebar-nav" class="ts-sidebar-nav">
            <!-- Navigation links are dynamically inserted here -->
        </nav>
        <div id="ts-settings-open-btn" class="ts-sidebar-footer" title="Settings">
            <i class="fas fa-cog"></i>
        </div>
    </aside>

    <main class="ts-main-content">
        <header class="ts-main-header">
            <div class="ts-header-left">
                <button id="ts-sidebar-toggle-btn" class="ts-sidebar-toggle-btn" title="Shrink Sidebar">
                    <i class="fas fa-angle-double-left"></i>
                </button>
                <h1 id="ts-main-title">Loading...</h1>
            </div>
            <div class="ts-header-right">
                <button id="ts-share-button" class="ts-share-button" title="Share Page">
                    <i class="fas fa-share-square"></i> Share
                </button>
            </div>
        </header>

        <nav id="ts-category-filter-tabs" class="ts-category-filter-tabs">
            <!-- Category filter tabs are dynamically inserted here -->
        </nav>

        <div class="ts-controls-bar">
            <div class="ts-search-wrapper">
                <i class="fas fa-search"></i>
                <input type="text" id="ts-search-input" placeholder="Search by name or tag...">
            </div>
            <div class="ts-filter-actions">
                <div class="ts-sort-wrapper">
                    <i class="fas fa-filter"></i>
                    <select id="ts-sort-select">
                        <option value="date-desc">Newest First</option>
                        <option value="date-asc">Oldest First</option>
                        <option value="name-asc">Name (A-Z)</option>
                        <option value="name-desc">Name (Z-A)</option>
                    </select>
                </div>
                 <div class="ts-view-options-wrapper">
                    <i class="fas fa-list-ol"></i>
                    <select id="ts-items-per-page">
                        <option value="10">10 per page</option>
                        <option value="25">25 per page</option>
                        <option value="50">50 per page</option>
                    </select>
                </div>
            </div>
        </div>

        <div id="ts-list-container" class="ts-list-container">
             <div class="ts-list-header">
                <div class="ts-header-item ts-col-name">Project Name</div>
                <div class="ts-header-item ts-col-tags">Categories</div>
                <div class="ts-header-item ts-col-date">Date Added</div>
                <div class="ts-header-item ts-col-action">Action</div>
            </div>
            <div id="ts-list-body" class="ts-list-body">
                <!-- List items are dynamically inserted here -->
            </div>
            <div id="ts-feedback-message" class="ts-feedback-message" style="display: none;">
                <!-- Feedback messages (loading, error, no results) shown here -->
            </div>
             <div id="ts-pagination-container" class="ts-pagination-container" style="display: none;">
                <!-- Pagination controls are dynamically inserted here -->
            </div>
        </div>
    </main>
</div>

<style type="text/css">
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

:root {
    --ts-sidebar-bg: #1e2a53;
    --ts-sidebar-width: 80px;
    --ts-main-bg: #f5f6fa;
    --ts-content-bg: #ffffff;
    --ts-primary-text: #2c3e50;
    --ts-secondary-text: #8492a6;
    --ts-border-color: #e6e9f0;
    --ts-accent-color: #4a69ff;
    --ts-accent-light: #eef2ff;
    --ts-radius: 8px;
    --ts-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    
    /* Dynamic variables for settings */
    --ts-font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    --ts-base-font-size: 16px;
}

.ts-table-dashboard-container {
    display: flex;
    min-height: 800px;
    background-color: var(--ts-main-bg);
    font-family: var(--ts-font-family);
    font-size: var(--ts-base-font-size);
    color: var(--ts-primary-text);
    transition: background-color 0.3s, color 0.3s;
}

/* --- Sidebar --- */
.ts-sidebar {
    width: var(--ts-sidebar-width);
    background-color: var(--ts-sidebar-bg);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px 0;
    flex-shrink: 0;
    transition: width 0.3s ease-in-out;
    overflow: hidden; /* Important for shrinking */
}
.ts-sidebar-logo { font-size: 2.5em; color: #fff; margin-bottom: 40px; }
.ts-sidebar-nav { display: flex; flex-direction: column; gap: 15px; width: 100%; }
.ts-sidebar-link { display: flex; align-items: center; justify-content: center; width: 100%; height: 50px; color: #a0aed4; font-size: 1.4em; text-decoration: none; position: relative; transition: color 0.2s ease, background-color 0.2s ease; }
.ts-sidebar-link:hover { color: #fff; }
.ts-sidebar-link.ts-active { color: #fff; background-color: rgba(255, 255, 255, 0.05); }
.ts-sidebar-link.ts-active::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background-color: var(--ts-accent-color); border-radius: 0 4px 4px 0; }
.ts-sidebar-footer { margin-top: auto; font-size: 1.4em; color: #a0aed4; cursor: pointer; transition: color 0.2s ease; }
.ts-sidebar-footer:hover { color: #fff; }

/* Shrunk state */
.ts-table-dashboard-container.ts-sidebar-shrunk .ts-sidebar {
    width: 0;
}

/* --- Main Content --- */
.ts-main-content { flex-grow: 1; padding: 0 30px 25px 30px; overflow-x: hidden; }

/* --- Sleek Modern Header --- */
.ts-main-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 30px;
    margin: 0 -30px 20px -30px; /* Stretch to fill parent's padding */
    border-bottom: 1px solid var(--ts-border-color);
    background-color: var(--ts-content-bg);
}
.ts-header-left, .ts-header-right { display: flex; align-items: center; gap: 16px; }
.ts-main-header h1 { font-size: 1.6em; font-weight: 600; margin: 0; }

.ts-sidebar-toggle-btn {
    background: none;
    border: 1px solid transparent;
    color: var(--ts-secondary-text);
    padding: 8px;
    width: 40px;
    height: 40px;
    border-radius: var(--ts-radius);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2em;
    transition: all 0.2s ease;
}
.ts-sidebar-toggle-btn:hover { background-color: var(--ts-accent-light); color: var(--ts-accent-color); }

.ts-share-button {
    background: var(--ts-accent-color);
    border: 1px solid var(--ts-accent-color);
    color: #fff;
    padding: 8px 15px;
    border-radius: var(--ts-radius);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
    transition: all 0.2s ease;
}
.ts-share-button:hover { opacity: 0.9; box-shadow: 0 2px 8px rgba(74, 105, 255, 0.3); }

/* --- Category Filter Tabs --- */
.ts-category-filter-tabs { display: flex; flex-wrap: wrap; gap: 8px 20px; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid var(--ts-border-color); }
.ts-cat-tab { padding: 5px; font-size: 0.9em; font-weight: 500; cursor: pointer; border: none; background: none; color: var(--ts-secondary-text); position: relative; transition: color 0.2s ease; border-bottom: 2px solid transparent; }
.ts-cat-tab:hover { color: var(--ts-primary-text); }
.ts-cat-tab.ts-active { color: var(--ts-accent-color); font-weight: 600; border-bottom-color: var(--ts-accent-color); }

/* --- Controls Bar --- */
.ts-controls-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; gap: 15px; }
.ts-search-wrapper { position: relative; flex-grow: 1; max-width: 400px; }
.ts-search-wrapper i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--ts-secondary-text); }
#ts-search-input { width: 100%; padding: 10px 15px 10px 40px; border-radius: var(--ts-radius); border: 1px solid var(--ts-border-color); background-color: var(--ts-content-bg); color: var(--ts-primary-text); }
#ts-search-input:focus { outline: none; border-color: var(--ts-accent-color); box-shadow: 0 0 0 3px var(--ts-accent-light); }
.ts-filter-actions { display: flex; align-items: center; gap: 15px; }
.ts-sort-wrapper, .ts-view-options-wrapper { display: flex; align-items: center; border: 1px solid var(--ts-border-color); border-radius: var(--ts-radius); padding: 0 10px; background-color: var(--ts-content-bg); }
.ts-sort-wrapper i, .ts-view-options-wrapper i { color: var(--ts-secondary-text); margin-right: 8px; }
#ts-sort-select, #ts-items-per-page { height: 38px; border: none; background: none; outline: none; cursor: pointer; color: var(--ts-primary-text); }

/* --- List View & Keyboard Focus --- */
.ts-list-container { background-color: var(--ts-content-bg); border-radius: var(--ts-radius); box-shadow: var(--ts-shadow); overflow: hidden; display: flex; flex-direction: column; }
.ts-list-header, .ts-list-item { display: grid; grid-template-columns: 2fr 2fr 1fr 1fr; align-items: center; padding: 15px 20px; gap: 15px; }
.ts-list-header { font-size: 0.8em; font-weight: 600; text-transform: uppercase; color: var(--ts-secondary-text); border-bottom: 1px solid var(--ts-border-color); }
.ts-list-body { flex-grow: 1; }
.ts-list-item { border-bottom: 1px solid var(--ts-border-color); transition: background-color 0.2s ease; cursor: pointer; outline: none; }
.ts-list-item:hover { background-color: var(--ts-accent-light); }
.ts-list-item:focus, .ts-list-item.ts-item-focus { background-color: var(--ts-accent-light); box-shadow: inset 3px 0 0 0 var(--ts-accent-color); }
.ts-list-item:last-child { border-bottom: none; }
.ts-project-name-link { font-weight: 600; color: var(--ts-primary-text); text-decoration: none; }
.ts-project-name-link:hover { color: var(--ts-accent-color); text-decoration: underline; }
.ts-project-tags { display: flex; flex-wrap: wrap; gap: 5px; }
.ts-tag { font-size: 0.75em; font-weight: 500; padding: 3px 8px; background-color: var(--ts-main-bg); color: var(--ts-secondary-text); border-radius: 4px; cursor: pointer; transition: background-color 0.2s, color 0.2s; }
.ts-tag:hover { background-color: var(--ts-accent-light); color: var(--ts-accent-color); }
.ts-project-date { font-size: 0.9em; color: var(--ts-secondary-text); }
.ts-visit-button { text-decoration: none; padding: 8px 15px; font-size: 0.85em; font-weight: 500; color: #fff; background-color: var(--ts-accent-color); border-radius: var(--ts-radius); text-align: center; transition: opacity 0.2s; }
.ts-visit-button:hover { opacity: 0.85; }

/* --- Pagination --- */
.ts-pagination-container { display: flex; justify-content: space-between; align-items: center; padding: 20px; border-top: 1px solid var(--ts-border-color); background-color: var(--ts-content-bg); }
.ts-page-numbers { display: flex; align-items: center; gap: 5px; }
.ts-pagination-button, .ts-page-number { padding: 8px 16px; border-radius: var(--ts-radius); border: 1px solid var(--ts-border-color); background-color: transparent; color: var(--ts-primary-text); cursor: pointer; font-weight: 500; transition: all 0.2s ease; }
.ts-pagination-button:disabled { opacity: 0.5; cursor: not-allowed; }
.ts-page-number { min-width: 40px; text-align: center; }
.ts-page-number:hover, .ts-pagination-button:not(:disabled):hover { border-color: var(--ts-accent-color); color: var(--ts-accent-color); }
.ts-page-number.ts-active { background-color: var(--ts-accent-color); color: #fff; border-color: var(--ts-accent-color); }
.ts-pagination-ellipsis { padding: 8px; color: var(--ts-secondary-text); }

/* --- Feedback Message --- */
.ts-feedback-message { padding: 50px 20px; text-align: center; color: var(--ts-secondary-text); min-height: 200px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
.ts-feedback-message i { font-size: 2em; margin-bottom: 15px; display: block; }

/* --- Settings Modal & Guide --- */
.ts-settings-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 1000; }
.ts-settings-modal-panel { background: var(--ts-content-bg); color: var(--ts-primary-text); padding: 30px 40px; border-radius: var(--ts-radius); box-shadow: 0 10px 30px rgba(0,0,0,0.2); width: 90%; max-width: 500px; position: relative; }
.ts-settings-close-btn { position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 2em; color: var(--ts-secondary-text); cursor: pointer; }
.ts-settings-modal-panel h2 { margin-top: 0; margin-bottom: 30px; }
.ts-settings-section { margin-bottom: 25px; }
.ts-settings-section:last-child { margin-bottom: 0; }
.ts-settings-section h3 { font-size: 1.1em; margin-bottom: 15px; border-bottom: 1px solid var(--ts-border-color); padding-bottom: 8px; }
.ts-setting-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.ts-setting-item label { font-weight: 500; }
.ts-setting-item select { padding: 8px; border-radius: var(--ts-radius); border: 1px solid var(--ts-border-color); background: var(--ts-main-bg); color: var(--ts-primary-text); }
.ts-shortcut-list { list-style: none; padding: 0; }
.ts-shortcut-list li { display: flex; align-items: center; gap: 15px; margin-bottom: 10px; }
.ts-shortcut-list span { background: var(--ts-main-bg); border: 1px solid var(--ts-border-color); padding: 2px 8px; border-radius: 4px; font-family: monospace; min-width: 20px; text-align: center; }

</style>

<script type="text/javascript">
document.addEventListener('DOMContentLoaded', () => {
    // --- DOM Elements ---
    const mainContainer = document.getElementById('ts-main-container');
    const sidebarToggleBtn = document.getElementById('ts-sidebar-toggle-btn');
    const settingsModal = document.getElementById('ts-settings-modal');
    const settingsOpenBtn = document.getElementById('ts-settings-open-btn');
    const settingsCloseBtn = document.getElementById('ts-settings-close-btn');
    const fontFamilySelect = document.getElementById('ts-font-family-select');
    const fontSizeSelect = document.getElementById('ts-font-size-select');
    const shareButton = document.getElementById('ts-share-button');

    // Other elements
    const sidebarNav = document.getElementById('ts-sidebar-nav');
    const mainTitle = document.getElementById('ts-main-title');
    const categoryTabsContainer = document.getElementById('ts-category-filter-tabs');
    const searchInput = document.getElementById('ts-search-input');
    const sortSelect = document.getElementById('ts-sort-select');
    const itemsPerPageSelect = document.getElementById('ts-items-per-page');
    const listBody = document.getElementById('ts-list-body');
    const feedbackMessage = document.getElementById('ts-feedback-message');
    const paginationContainer = document.getElementById('ts-pagination-container');

    // --- Configuration & State ---
    const SOURCE_CONFIG = [
        { name: "Earning Projects", icon: "fa-rocket", url: "https://ttearncrypto.blogspot.com" },
        { name: "Investments Projects", icon: "fa-chart-line", url: "https://freecryptoradar.blogspot.com" },
        { name: "Casinos Directory", icon: "fa-dice", url: "https://freecryptoshop.blogspot.com" },
        { name: "Crypto Airdrops", icon: "fa-parachute-box", url: "https://ttairdropcentral.blogspot.com" },
        { name: "News & Daily Codes", icon: "fa-newspaper", url: "https://cryptoradarnews.blogspot.com" }
    ];
    let dataCache = {}, currentSourceUrl = null, currentProjects = [], activeCategory = 'All';
    let searchDebounceTimer, currentPage = 1, projectsPerPage = parseInt(itemsPerPageSelect.value, 10);

    // --- Settings Logic ---
    const applySetting = (key, value) => {
        document.documentElement.style.setProperty(`--ts-${key}`, value);
        localStorage.setItem(`ts-setting-${key}`, value);
    };

    const loadSettings = () => {
        const fontFamily = localStorage.getItem('ts-setting-font-family') || 'Inter, sans-serif';
        const fontSize = localStorage.getItem('ts-setting-base-font-size') || '16px';

        applySetting('font-family', fontFamily);
        applySetting('base-font-size', fontSize);

        fontFamilySelect.value = fontFamily;
        fontSizeSelect.value = fontSize;
    };
    
    // --- Data Fetching & UI Rendering ---
    function renderListItems(projects) {
        listBody.innerHTML = '';
        if (projects.length === 0) return;
        hideFeedback();
        const fragment = document.createDocumentFragment();
        projects.forEach((project, index) => {
            const item = document.createElement('div');
            item.className = 'ts-list-item';
            item.tabIndex = 0; // Make item focusable
            
            const tagsHTML = project.tags.map(tag => `<span class="ts-tag" data-tag="${tag}">${tag}</span>`).join('');
            
            item.innerHTML = `
                <div class="ts-col-name" data-label="Project">
                    <a href="${project.url}" target="_blank" rel="noopener noreferrer" class="ts-project-name-link">${project.name}</a>
                </div>
                <div class="ts-col-tags" data-label="Categories"><div class="ts-project-tags">${tagsHTML}</div></div>
                <div class="ts-col-date" data-label="Date"><span class="ts-project-date">${project.publishedDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}</span></div>
                <div class="ts-col-action" data-label="Action"><a href="${project.url}" target="_blank" rel="noopener noreferrer" class="ts-visit-button">View Project</a></div>
            `;
            fragment.appendChild(item);
        });
        listBody.appendChild(fragment);
    }
    
    // --- Keyboard Navigation ---
    const handleKeyboardNavigation = (e) => {
        const activeEl = document.activeElement;
        const isInputFocused = ['INPUT', 'SELECT', 'TEXTAREA'].includes(activeEl.tagName);

        if (e.key === '/' && !isInputFocused) {
            e.preventDefault();
            searchInput.focus();
        }
        if (e.key === 'Escape' && isInputFocused) {
            activeEl.blur();
        }

        if (isInputFocused && activeEl !== searchInput) return;

        const items = Array.from(listBody.querySelectorAll('.ts-list-item'));
        if (items.length === 0) return;

        let currentIndex = items.findIndex(item => item === activeEl);
        
        switch (e.key) {
            case 'j': case 'ArrowDown':
                e.preventDefault();
                items[(currentIndex + 1) % items.length].focus();
                break;
            case 'k': case 'ArrowUp':
                e.preventDefault();
                items[(currentIndex - 1 + items.length) % items.length].focus();
                break;
            case 'Enter':
                if (currentIndex > -1) {
                    e.preventDefault();
                    items[currentIndex].querySelector('.ts-visit-button').click();
                }
                break;
            case 'n': if(!isInputFocused) document.getElementById('ts-next-page')?.click(); break;
            case 'p': if(!isInputFocused) document.getElementById('ts-prev-page')?.click(); break;
        }
    };

    // --- Initialization ---
    function init() {
        loadSettings();
        renderSidebar();

        // Event Listeners
        document.addEventListener('keydown', handleKeyboardNavigation);
        
        sidebarToggleBtn.addEventListener('click', () => {
            mainContainer.classList.toggle('ts-sidebar-shrunk');
            const isShrunk = mainContainer.classList.contains('ts-sidebar-shrunk');
            const icon = sidebarToggleBtn.querySelector('i');
            if (isShrunk) {
                icon.classList.remove('fa-angle-double-left');
                icon.classList.add('fa-angle-double-right');
                sidebarToggleBtn.title = "Expand Sidebar";
            } else {
                icon.classList.remove('fa-angle-double-right');
                icon.classList.add('fa-angle-double-left');
                sidebarToggleBtn.title = "Shrink Sidebar";
            }
        });

        settingsOpenBtn.addEventListener('click', () => settingsModal.style.display = 'flex');
        settingsCloseBtn.addEventListener('click', () => settingsModal.style.display = 'none');
        settingsModal.addEventListener('click', (e) => {
            if (e.target === settingsModal) settingsModal.style.display = 'none';
        });
        
        fontFamilySelect.addEventListener('change', (e) => applySetting('font-family', e.target.value));
        fontSizeSelect.addEventListener('change', (e) => applySetting('base-font-size', e.target.value));
        
        shareButton.addEventListener('click', async () => { /* ... (unchanged) ... */ });

        // Existing Listeners
        sidebarNav.addEventListener('click', (e) => { /* ... (unchanged) ... */ });
        categoryTabsContainer.addEventListener('click', (e) => { /* ... (unchanged) ... */ });
        listBody.addEventListener('click', (e) => { /* ... (unchanged) ... */ });
        sortSelect.addEventListener('change', applyFiltersAndSort);
        itemsPerPageSelect.addEventListener('change', (e) => { /* ... (unchanged) ... */ });
        searchInput.addEventListener('input', () => { /* ... (unchanged) ... */ });
        paginationContainer.addEventListener('click', handlePaginationClick);

        document.querySelector('.ts-sidebar-link').click();
    }

    // --- CORE & UNCHANGED FUNCTIONS ---
    var fetchJsonp, processEntries, showFeedback, hideFeedback, renderSidebar, populateCategoryTabs, renderPagination, applyFiltersAndSort, loadSourceData, handleFilterChange, handlePaginationClick;
    fetchJsonp = function(url, callbackName) { return new Promise((resolve, reject) => { window[callbackName] = (data) => { resolve(data); cleanup(); }; const script = document.createElement('script'); script.src = `${url}&callback=${callbackName}`; script.onerror = (err) => reject(err); const cleanup = () => { delete window[callbackName]; script.remove(); }; document.body.appendChild(script); }); }
    processEntries = function(entries) { return entries.map(entry => { const link = (entry.link.find(l => l.rel === 'alternate') || {}).href; const tags = (entry.category || []).map(cat => cat.term.trim()).filter(cat => cat && !cat.startsWith("http")); return { id: entry.id.$t, name: entry.title.$t.trim(), url: link, tags: tags.length > 0 ? tags : ['General'], publishedDate: new Date(entry.published.$t), }; }).filter(p => p.url); }
    showFeedback = function(message, iconClass = 'fa-info-circle') { listBody.innerHTML = ''; paginationContainer.style.display = 'none'; feedbackMessage.innerHTML = `<i class="fas ${iconClass}"></i><p>${message}</p>`; feedbackMessage.style.display = 'flex'; }
    hideFeedback = function() { feedbackMessage.style.display = 'none'; }
    renderSidebar = function() { sidebarNav.innerHTML = SOURCE_CONFIG.map(source => `<a href="#" class="ts-sidebar-link" data-url="${source.url}" data-name="${source.name}" title="${source.name}"><i class="fas ${source.icon}"></i></a>`).join(''); }
    populateCategoryTabs = function(projects) { const sortedCategories = [...new Set(projects.flatMap(p => p.tags))].sort(); let tabsHTML = `<button class="ts-cat-tab ts-active" data-category="All">All</button>`; tabsHTML += sortedCategories.map(cat => `<button class="ts-cat-tab" data-category="${cat}">${cat}</button>`).join(''); categoryTabsContainer.innerHTML = tabsHTML; activeCategory = 'All'; }
    renderPagination = function(totalItems) { const totalPages = Math.ceil(totalItems / projectsPerPage); paginationContainer.innerHTML = ''; paginationContainer.style.display = totalPages > 1 ? 'flex' : 'none'; if (totalPages <= 1) return; let paginationHTML = `<button class="ts-pagination-button" id="ts-prev-page" ${currentPage === 1 ? 'disabled' : ''}>← Previous</button>`; const pageNumbersContainer = document.createElement('div'); pageNumbersContainer.className = 'ts-page-numbers'; const pagesToShow = new Set(); pagesToShow.add(1); pagesToShow.add(totalPages); pagesToShow.add(currentPage); if (currentPage > 1) pagesToShow.add(currentPage - 1); if (currentPage < totalPages) pagesToShow.add(currentPage + 1); let lastPage = 0; Array.from(pagesToShow).sort((a,b) => a - b).forEach(page => { if (lastPage !== 0 && page > lastPage + 1) { const ellipsis = document.createElement('span'); ellipsis.className = 'ts-pagination-ellipsis'; ellipsis.textContent = '...'; pageNumbersContainer.appendChild(ellipsis); } const pageButton = document.createElement('button'); pageButton.className = `ts-page-number ${page === currentPage ? 'ts-active' : ''}`; pageButton.dataset.page = page; pageButton.textContent = page; pageNumbersContainer.appendChild(pageButton); lastPage = page; }); paginationHTML += pageNumbersContainer.outerHTML; paginationHTML += `<button class="ts-pagination-button" id="ts-next-page" ${currentPage === totalPages ? 'disabled' : ''}>Next →</button>`; paginationContainer.innerHTML = paginationHTML; }
    applyFiltersAndSort = function() { let projects = [...currentProjects]; const searchTerm = searchInput.value.toLowerCase().trim(); const sortOrder = sortSelect.value; if (activeCategory !== 'All') { projects = projects.filter(p => p.tags.includes(activeCategory)); } if (searchTerm) { projects = projects.filter(p => p.name.toLowerCase().includes(searchTerm) || p.tags.some(tag => tag.toLowerCase().includes(searchTerm))); } switch (sortOrder) { case 'name-asc': projects.sort((a, b) => a.name.localeCompare(b.name)); break; case 'name-desc': projects.sort((a, b) => b.name.localeCompare(a.name)); break; case 'date-desc': projects.sort((a, b) => b.publishedDate - a.publishedDate); break; case 'date-asc': projects.sort((a, b) => a.publishedDate - b.publishedDate); break; } if (projects.length === 0) { showFeedback('No projects found matching your criteria.', 'fa-search-minus'); return; } renderPagination(projects.length); const startIndex = (currentPage - 1) * projectsPerPage; const endIndex = startIndex + projectsPerPage; const paginatedProjects = projects.slice(startIndex, endIndex); renderListItems(paginatedProjects); }
    loadSourceData = async function(url, name) { if (currentSourceUrl === url) return; currentSourceUrl = url; currentPage = 1; mainTitle.textContent = name; categoryTabsContainer.innerHTML = ''; showFeedback('Loading projects...', 'fa-spinner fa-spin'); if (dataCache[url]) { currentProjects = dataCache[url]; populateCategoryTabs(currentProjects); applyFiltersAndSort(); return; } try { const callbackName = `tsJsonpCallback_${url.replace(/[^a-zA-Z0-9]/g, '')}`; const data = await fetchJsonp(`${url}/feeds/posts/summary?alt=json-in-script&max-results=500`, callbackName); const projects = processEntries(data.feed.entry || []); dataCache[url] = projects; currentProjects = projects; populateCategoryTabs(currentProjects); applyFiltersAndSort(); } catch (error) { console.error(`Failed to load source: ${name}`, error); showFeedback('Could not load projects. Please try again later.', 'fa-exclamation-triangle'); } }
    handleFilterChange = function() { currentPage = 1; applyFiltersAndSort(); }
    handlePaginationClick = function(e) { const target = e.target; const totalPages = Math.ceil(currentProjects.length / projectsPerPage); if (target.id === 'ts-next-page' && currentPage < totalPages) { currentPage++; } else if (target.id === 'ts-prev-page' && currentPage > 1) { currentPage--; } else if (target.matches('.ts-page-number')) { currentPage = parseInt(target.dataset.page, 10); } else { return; } applyFiltersAndSort(); }
    sidebarNav.addEventListener('click', (e) => { e.preventDefault(); const link = e.target.closest('.ts-sidebar-link'); if (!link || link.classList.contains('ts-active')) return; document.querySelectorAll('.ts-sidebar-link.ts-active').forEach(l => l.classList.remove('ts-active')); link.classList.add('ts-active'); loadSourceData(link.dataset.url, link.dataset.name); });
    categoryTabsContainer.addEventListener('click', (e) => { const tab = e.target.closest('.ts-cat-tab'); if (!tab || tab.classList.contains('ts-active')) return; document.querySelectorAll('.ts-cat-tab.ts-active').forEach(t => t.classList.remove('ts-active')); tab.classList.add('ts-active'); activeCategory = tab.dataset.category; handleFilterChange(); });
    listBody.addEventListener('click', (e) => { const tagEl = e.target.closest('.ts-tag'); if (!tagEl) return; const tagName = tagEl.dataset.tag; const correspondingTab = categoryTabsContainer.querySelector(`.ts-cat-tab[data-category="${tagName}"]`); if (correspondingTab) correspondingTab.click(); });
    itemsPerPageSelect.addEventListener('change', (e) => { projectsPerPage = parseInt(e.target.value, 10); handleFilterChange(); });
    searchInput.addEventListener('input', () => { clearTimeout(searchDebounceTimer); searchDebounceTimer = setTimeout(handleFilterChange, 300); });
    paginationContainer.addEventListener('click', handlePaginationClick);
    shareButton.addEventListener('click', async () => { const shareData = { title: `Crypto Dashboard: ${mainTitle.textContent}`, text: `Check out these projects on the Crypto Dashboard!`, url: window.location.href }; try { if (navigator.share) { await navigator.share(shareData); } else { alert('Web Share API not supported. Feature coming soon!'); } } catch (err) { console.error("Share failed:", err); } });
    
    init();
});
</script>
